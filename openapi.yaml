openapi: 3.0.3
info:
  title: Expense Tracker API
  version: 1.0.0
servers:
  - url: http://localhost:3000

paths:
  /api/v1/health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: ok

  /api/v1/auth/register:
    post:
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRegisterRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthRegisterResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "409":
          description: Email already in use
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/v1/auth/login:
    post:
      summary: Login (returns JWT)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthLoginRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthLoginResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/v1/users/me:
    get:
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserMeResponse"
        "401":
          description: Unauthorized (missing/invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/v1/projects:
    get:
      summary: List projects
      parameters:
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 20, default: 10 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectsListResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    post:
      summary: Create project
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/v1/projects/{id}:
    get:
      summary: Get project by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, minimum: 1 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    put:
      summary: Update project by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, minimum: 1 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectCreate"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    delete:
      summary: Delete project by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, minimum: 1 }
      responses:
        "204":
          description: No content
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ApiError:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Invalid request body
      required: [error]

    Project:
      type: object
      properties:
        id: { type: integer, example: 1 }
        name: { type: string, example: "Project A" }
        price_cents: { type: integer, example: 1000 }
        created_at: { type: string, format: date-time, example: "2026-02-09T17:04:05.154Z" }
      required: [id, name, price_cents, created_at]

    ProjectCreate:
      type: object
      properties:
        name: { type: string, example: "Project X" }
        price_cents: { type: integer, example: 1234 }
      required: [name, price_cents]

    ProjectsListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Project"
        meta:
          type: object
          properties:
            page: { type: integer, example: 1 }
            limit: { type: integer, example: 10 }
            total: { type: integer, example: 5 }
      required: [data, meta]

    ProjectResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/Project"
      required: [data]

    AuthRegisterRequest:
      type: object
      properties:
        email: { type: string, format: email, example: "user@mail.com" }
        password: { type: string, minLength: 8, example: "12345678" }
      required: [email, password]

    AuthLoginRequest:
      type: object
      properties:
        email: { type: string, format: email, example: "user@mail.com" }
        password: { type: string, minLength: 8, example: "12345678" }
      required: [email, password]

    UserRegistered:
      type: object
      properties:
        id: { type: integer, example: 1 }
        email: { type: string, format: email, example: "user@mail.com" }
        role: { type: string, example: "user" }
        created_at: { type: string, format: date-time, example: "2026-02-18T10:00:00.000Z" }
      required: [id, email, role, created_at]

    AuthRegisterResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/UserRegistered"
      required: [data]

    AuthUserInToken:
      type: object
      properties:
        id: { type: integer, example: 1 }
        email: { type: string, format: email, example: "user@mail.com" }
      required: [id, email]

    AuthLoginResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            token: { type: string, example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." }
            user:
              $ref: "#/components/schemas/AuthUserInToken"
          required: [token, user]
      required: [data]

    UserMe:
      type: object
      properties:
        id: { type: integer, example: 1 }
        email: { type: string, format: email, example: "user@mail.com" }
        created_at: { type: string, format: date-time, example: "2026-02-18T10:00:00.000Z" }
      required: [id, email, created_at]

    UserMeResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/UserMe"
      required: [data]
